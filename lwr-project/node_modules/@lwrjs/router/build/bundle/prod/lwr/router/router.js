function e(e=""){return e=e||"",decodeURIComponent(e)}function t(e){"/"!==(e=e||"/").charAt(0)&&(e="/"+e);const t=e.match(/^[^#?]+/);if(null!==t){const e=t[0];return"/"===e?"/":e.replace(/\/$/,"")}return"/"}function n(t){const n=(t=t||"").indexOf("#");n>=0&&(t=t.substring(0,n));const r=t.indexOf("?"),i=r>=0?t.substr(r+1):null,o={};return i&&i.split("&").forEach((t=>{if(t.indexOf("=")>=0){const[n,r=""]=t.split("=");o[e(n)]=e(r)}else o[e(t)]=null})),o}function r(e={}){const t=Object.keys(e);return t.length?`?${t.map((t=>{const n=e[t];return null===n?t:`${t}=${function(e=""){return e=e||"",encodeURIComponent(e)}(n)}`})).join("&")}`:""}function i(e){return!!(e&&e.length>1)&&e.startsWith(":")}function o(e){return!!e&&(!!i(e)&&e.substr(1))}function s(e){return Object.values(e).reduce(((e,{routeParamName:t})=>{const n=o(t);return n&&e.push(n),e}),[])}function a(t,n){const{regex:r,params:i}=n,o=r.exec(t);if(o){const[,...t]=o,n={};return i.forEach(((r,i)=>{const{name:o}=r,s=t[i];n[o]=s?e(s):s})),n}return null}function c(t,n){if(t&&n){const{queryMatcher:r}=n,i=r(t);if(i){const t={};return Object.keys(i).forEach((n=>{const r=i[n],{value:o,routeParamName:s}=r,a=s?s.substr(1):n;t[a]=o?e(o):o})),t}}return null}function u(e,r){if(r){const{original:{page:{type:o="",attributes:s={},state:u={}}={}}={}}=r,l=t(e),f=n(e),d=a(l,r),p=c(f,r);if(d&&p){const e={...d,...p},t={};Object.keys(s).forEach((n=>{const r=s[n];let o;if(r&&i(r)){const t=r.substr(1);o=e[t]}else o=r;t[n]=o}));const n={};Object.keys(u).forEach((t=>{const r=u[t];let o;if(r&&i(r)){const t=r.substr(1);o=e[t]}else o=r;n[t]=o}));const a=function(e,t){const{compiledQuery:n}=t,r=Object.keys(n).filter((e=>{const{literalValue:t}=n[e];return!t})),i={};return Object.keys(e).forEach((t=>{const n=e[t];r.indexOf(t)<0&&(i[t]=n)})),i}(f,r);return{type:o,attributes:{...t},state:{...a,...n}}}}return null}const l={locale:"en-US",defaultLocale:"en-US"};function f(e,r){const i=t(e),o=n(e),s=r?r.filter((e=>e.regex.test(i))):[],[u]=s.filter((e=>{const{queryMatcher:t}=e;return t(o)&&function(e,t,n){const{original:{patterns:r=null}={}}=n||{};if(r){const i={...a(e,n),...c(t,n)};return Object.keys(r).every((e=>{const t=r[e],n=new RegExp(t),o=i[e]||"";return n.test(o)}))}return!0}(i,o,e)}));return u||null}function d(e,t,n="",r=l,i){if(!n||e!==n&&0!==e?.search(new RegExp(`^${n}[/?#]`))||(e=e.replace(n,"")),i?.locale||r?.locale){const t=`/${i?.locale||r.locale}`;e!==t&&0!==e?.search(new RegExp(`^${t}[/?#]`))||(e=e.replace(t,""))}const o=f(e,t);let s;if(!o)return null;{const t=u(e,o);if(t){return s={route:{id:o.original.id,attributes:{...t.attributes},state:{...t.state},pageReference:{type:t.type,attributes:{...t.attributes},state:{...t.state}}},routeDefinition:o},s}}return null}function p(e,t,n="",r=l,o){const s=function(e,t){if(!e)return null;const{type:n,attributes:r={},state:o={}}=e;if(n){const[e]=t.filter((e=>{const{original:{page:{type:t=null,attributes:s={},state:a={}}={}}}=e,c=t===n,u=Object.keys(s).every((e=>Object.keys(r).indexOf(e)>=0)),l=Object.keys(s).length===Object.keys(r).length,f=Object.keys(a).every((e=>Object.keys(o).indexOf(e)>=0)),d=Object.keys(s).filter((e=>{const t=s[e];return!t||!i(t)})).every((e=>s[e]===r[e])),p=Object.keys(a).filter((e=>{const t=a[e];return null===t||!i(t)})).every((e=>a[e]===o[e]));return c&&u&&l&&d&&f&&p}));return e||null}return null}(e,t);return s?g(e,s,n,r,o):null}function h(e,t,n){const{attributeBindings:r,stateBindings:i}=n,{attributes:s,state:a}=t,c={};return e.forEach((e=>{const[t]=Object.keys(r).filter((t=>o(r[t])===e));if(t)c[e]=s[t];else{const[t]=Object.keys(i).filter((t=>o(i[t])===e));t&&(c[e]=a[t])}})),c}function g(e,t,n="",a=l,c){const{params:u,original:{page:f={}}={},toPath:d,compiledQuery:p}=t,{attributes:g={},state:m={}}=f,E=d(h(u.filter((({name:e})=>"string"==typeof e)).map((({name:e})=>e)),e,{attributeBindings:g,stateBindings:m})),y=function(e,t,n){const{compiledQuery:r,original:{page:{state:s={}}}}=n,{state:a={}}=e||{},c={};Object.keys(a).filter((e=>!i(s[e]))).forEach((e=>c[e]=a[e]));const u={};return Object.keys(t).forEach((e=>{const n=t[e],[i]=Object.keys(r).filter((t=>{const n=r[t],{routeParamName:i}=n;return o(i)===e}));if(i){u[i]=n}})),{...c,...u}}(e,h(s(p),e,{attributeBindings:g,stateBindings:m}),t),b=r(y),R=c?.locale||a&&a.locale;return`${n}${R!==a.defaultLocale?`/${R}`:""}${E}${b}`}function m(e,t=2){if(function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}(e))try{Object.freeze(e),t>0&&Object.keys(e).forEach((n=>{if(function(e,t){return t in e}(e,n)){const r=e[n];r&&"object"==typeof r&&m(r,t-1)}}))}catch(e){}return e}const E="LWR",y=1;function b(e,t){return Array.isArray(t)?e.replace(/\{([0-9]+)\}/g,((e,n)=>t[n])):e}function R(e,t){return`${e.code}: ${b(e.message,t)}`}function I(e,t){const n={...e,message:b(e.message,t)};return e.address&&(n.address=b(e.address,t)),e.stack&&(n.stack=b(e.stack,t)),n}function v(e,t,n){if(!e)throw new Error(R(t,n))}const $={INVALID_MIXIN_CMP:{code:`${E}4001`,message:"{0} must be an Element type",level:y},MISSING_CONTEXT:{code:`${E}4002`,message:"Could not find context to perform navigation action.",level:y},INVALID_CONTEXT:{code:`${E}4003`,message:"Cannot register navigation context; it must have this shape: { navigate, generateUrl, subscribe }",level:y},MULTIPLE_ROOTS:{code:`${E}4004`,message:"Router connection failed. There can only be one root router.",level:y},MULTIPLE_CHILDREN:{code:`${E}4005`,message:"Could not add to the navigation hierarchy. There can only be one child per navigation node.",level:y},MISSING_ROUTE:{code:`${E}4006`,message:'A route cannot be created to navigate to URL "{0}"',level:y,address:"{0}"},MISSING_URL:{code:`${E}4007`,message:'A URL cannot be created to navigate to route "{0}"',level:y,address:"{0}"},PRENAV_FAILED:{code:`${E}4008`,message:'A preNavigate hook listener blocked routing to "{0}"',level:2,address:"{0}"},MISSING_ROUTE_TEMPLATE:{code:`${E}4009`,message:'Route definition with id "{0}" is missing a "uri" property.',level:y,address:"{0}"},MISSING_ROUTE_CMP:{code:`${E}4016`,message:"Expected a route view component with a default export.",level:y},MISSING_DATA_CONTEXT:{code:`${E}4018`,message:"Could not find context to retrieve navigation data.",level:y},INVALID_ROUTE_QUERY:{code:`${E}4019`,message:"Invalid query param in route definition.",level:y},MISSING_PAGE_BINDING:{code:`${E}4020`,message:'Route definition with id "{0}" is missing a "page" binding.',level:y,address:"{0}"},INVALID_PAGE_BINDING:{code:`${E}4021`,message:'Route definition with id "{0}" has an invalid "page" binding.',level:y,address:"{0}"},INVALID_URI_SYNTAX:{code:`${E}4022`,message:'Route definition with id "{0}" has invalid "uri" syntax. URI cannot contain *, +, (, ), ',level:y,address:"{0}"},VIEW_IMPORT_FAILED:{code:`${E}4023`,message:'Error importing view with name "{0}", failure was: {1}',level:y,stack:"{2}"},VIEW_MISSING:{code:`${E}4024`,message:'Expected a view with name "{0}" in the viewset',level:y},VIEW_IMPORT_FAILED_WITH_SPECIFIER:{code:`${E}4025`,message:'Error importing module "{0}" from view with name "{1}", failure was: {2}',level:y,stack:"{3}"},NO_ROUTE_MATCH:{code:`${E}4026`,message:"A routing match cannot be found for: {0}",level:y},INVALID_ROUTE_HANDLER:{code:`${E}4027`,message:'Route definition "{0}" does not have a valid route handler module',level:y},DESTINATION_NOT_FOUND:{code:`${E}4028`,message:"Route handler returned 404: Not Found",level:y},DESTINATION_ERROR:{code:`${E}4029`,message:"Route handler returned error status {0}: {1}",level:y,stack:"{2}"},NO_INIT_URL:{code:`${E}4030`,message:'Cannot initialize a server router without a "url"',level:y}};function O(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function N(e){return e&&e.sensitive?"":"i"}function _(e,t={}){const n=function(e){const t=[];let n=0;for(;n<e.length;){const r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{let r=1,i="",o=n+1;if("?"===e[o])throw new TypeError(`Pattern cannot start with "?" at ${o}`);for(;o<e.length;)if("\\"!==e[o]){if(")"===e[o]){if(r--,0===r){o++;break}}else if("("===e[o]&&(r++,"?"!==e[o+1]))throw new TypeError(`Capturing groups are not allowed at ${o}`);i+=e[o++]}else i+=e[o++]+e[o++];if(r)throw new TypeError(`Unbalanced pattern at ${n}`);if(!i)throw new TypeError(`Missing pattern at ${n}`);t.push({type:"PATTERN",index:n,value:i}),n=o}else{let r="",i=n+1;for(;i<e.length;){const t=e.charCodeAt(i);if(!(t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95===t))break;r+=e[i++]}if(!r)throw new TypeError(`Missing parameter name at ${n}`);t.push({type:"NAME",index:n,value:r}),n=i}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),{prefixes:r="./"}=t,i=`[^${O(t.delimiter||"/#?")}]+?`,o=[];let s=0,a=0,c="";const u=e=>{if(a<n.length&&n[a].type===e)return n[a++].value},l=e=>{const t=u(e);if(void 0!==t)return t;const{type:r,index:i}=n[a];throw new TypeError(`Unexpected ${r} at ${i}, expected ${e}`)},f=()=>{let e,t="";for(;e=u("CHAR")||u("ESCAPED_CHAR");)t+=e;return t};for(;a<n.length;){const e=u("CHAR"),t=u("NAME"),n=u("PATTERN");if(t||n){let a=e||"";-1===r.indexOf(a)&&(c+=a,a=""),c&&(o.push(c),c=""),o.push({name:t||s++,prefix:a,suffix:"",pattern:n||i,modifier:u("MODIFIER")||""});continue}const a=e||u("ESCAPED_CHAR");if(a){c+=a;continue}c&&(o.push(c),c="");if(u("OPEN")){const e=f(),t=u("NAME")||"",n=u("PATTERN")||"",r=f();l("CLOSE"),o.push({name:t||(n?s++:""),pattern:t&&!n?i:n,prefix:e,suffix:r,modifier:u("MODIFIER")||""})}else l("END")}return o}function A(e,t){return function(e,t={}){const n=N(t),{encode:r=e=>e,validate:i=!0}=t,o=e.map((e=>{if("object"==typeof e)return new RegExp(`^(?:${e.pattern})$`,n)}));return t=>{let n="";for(let s=0;s<e.length;s++){const a=e[s];if("string"==typeof a){n+=a;continue}const c=t?t[a.name]:void 0,u="?"===a.modifier||"*"===a.modifier,l="*"===a.modifier||"+"===a.modifier;if(Array.isArray(c)){if(!l)throw new TypeError(`Expected "${a.name}" to not repeat, but got an array`);if(0===c.length){if(u)continue;throw new TypeError(`Expected "${a.name}" to not be empty`)}for(let e=0;e<c.length;e++){const t=r(c[e],a);if(i&&!o[s].test(t))throw new TypeError(`Expected all "${a.name}" to match "${a.pattern}", but got "${t}"`);n+=a.prefix+t+a.suffix}continue}if("string"==typeof c||"number"==typeof c){const e=r(String(c),a);if(i&&!o[s].test(e))throw new TypeError(`Expected "${a.name}" to match "${a.pattern}", but got "${e}"`);n+=a.prefix+e+a.suffix;continue}if(u)continue;const f=l?"an array":"a string";throw new TypeError(`Expected "${a.name}" to be ${f}`)}return n}}(_(e,t),t)}function w(e,t,n){return function(e,t,n={}){const{strict:r=!1,start:i=!0,end:o=!0,encode:s=e=>e}=n,a=`[${O(n.endsWith||"")}]|$`,c=`[${O(n.delimiter||"/#?")}]`;let u=i?"^":"";for(const n of e)if("string"==typeof n)u+=O(s(n));else{const e=O(s(n.prefix)),r=O(s(n.suffix));if(n.pattern)if(t&&t.push(n),e||r)if("+"===n.modifier||"*"===n.modifier){const t="*"===n.modifier?"?":"";u+=`(?:${e}((?:${n.pattern})(?:${r}${e}(?:${n.pattern}))*)${r})${t}`}else u+=`(?:${e}(${n.pattern})${r})${n.modifier}`;else u+=`(${n.pattern})${n.modifier}`;else u+=`(?:${e}${r})${n.modifier}`}if(o)r||(u+=`${c}?`),u+=n.endsWith?`(?=${a})`:"$";else{const t=e[e.length-1],n="string"==typeof t?c.indexOf(t[t.length-1])>-1:void 0===t;r||(u+=`(?:${c}(?=${a}))?`),n||(u+=`(?=${c}|${a})`)}return new RegExp(u,N(n))}(_(e,n),t,n)}function x(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;const n=e.source.match(/\((?!\?)/g);if(n)for(let e=0;e<n.length;e++)t.push({name:e,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,t):Array.isArray(e)?function(e,t,n){const r=e.map((e=>x(e,t,n).source));return new RegExp(`(?:${r.join("|")})`,N(n))}(e,t,n):w(e,t,n)}const{INVALID_ROUTE_QUERY:T,MISSING_ROUTE_TEMPLATE:U,MISSING_PAGE_BINDING:D,INVALID_PAGE_BINDING:P,INVALID_URI_SYNTAX:C}=$;function S(e){const{routes:r,caseSensitive:a}=e;return r.map((e=>function(e,r=!1){const a=[],{id:c,uri:u,page:l}=e;v(!!u,I(U,[c])),v(function(e=""){const t=["*","(",")",";"].some((t=>e.indexOf(t)>=0));return!t}(u),I(C,[c])),v(!!l,I(D,[c]));const f=t(u),d=n(u),p=x(f,a,{sensitive:r,end:!1!==e.exact}),h=A(f,{encode:encodeURIComponent}),g=function(e){const t={};return Object.keys(e).forEach((n=>{const r=e[n];v(!i(n)||null===r,T),i(n)?t[n.substr(1)]={routeParamName:n}:r&&i(r)?t[n]={routeParamName:r}:t[n]={literalValue:null===r?null:r}})),t}(d),m=function(e,t=!1){const n=n=>{const r=Object.keys(n),i=Object.keys(e);return i.every((e=>r.indexOf(e)>=0))?i.reduce(((r,i)=>{if(null===r)return null;const{literalValue:o,routeParamName:s}=e[i],a=n[i];let c=!0;return"string"==typeof o?c=t?o===a:o.toUpperCase()===(null==a?a:a.toUpperCase()):null===o&&(c=a===o),r=c?{...r,[i]:{value:a,routeParamName:s}}:null}),{}):null};return n}(g,r),E={original:e,regex:p,params:a,toPath:h,compiledQuery:g,queryMatcher:m};return v(function(e){const{original:{page:t}={},params:n,compiledQuery:r}=e,a=t?t.type:t,c=(t?t.attributes:t)||{},u=(t?t.state:t)||{};if("string"!=typeof a||"object"!=typeof c||"object"!=typeof u)return!1;const l=Object.values(n).map((({name:e})=>e)),f=s(r),d=[...l,...f],p=Object.values(c).filter(i).map(o),h=Object.values(u).filter(i).map(o),g=d.every((e=>"string"==typeof e&&(p.indexOf(e)>=0||h.indexOf(e)>=0))),m=d.length===p.length+h.length;return!!(t&&a&&c&&u&&g&&m)}(E),I(P,[c])),E}(e,a)))}function j(){let e,t,n=[];const r=r=>{n.filter((e=>null!==e)).forEach((e=>e.error&&e.error(r))),e=void 0,t=r};return{next:r=>{n.filter((e=>null!==e)).forEach((e=>e.next&&e.next(r))),e=r,t=void 0},error:r,complete:()=>{n.filter((e=>null!==e)).forEach((e=>e.complete&&e.complete())),n=[],e=void 0,t=void 0},subscribe:(i,o=!0)=>{(e=>{n.push(e)})(i),e&&o&&i.next(e),t&&r(t);const s=n.length-1;return{unsubscribe:()=>(e=>{n=[...n.slice(0,e),...n.slice(e+1)]})(s)}}}}class M{constructor(e){this.deprecatedConfig={},this.routeHandlerId=0,this.compiledRoutes=[],this.routeObservable=j(),this.basePath=e.basePath||"",this.config={basePath:this.basePath,i18n:e.i18n||l,caseSensitive:Boolean(e.caseSensitive),routes:e.routes||[],generateUrl:(e,t)=>p(e,this.compiledRoutes,this.config.basePath,this.config.i18n,t),parseUrl:e=>function(e,t,n="",r=l){const i=d(e,t,n,r);return i&&i.route&&i.route.pageReference?i.route.pageReference:null}(e,this.compiledRoutes,this.config.basePath,this.config.i18n)};const{generateUrlFilter:t,DEPRECATED_getRouteFromUrl:n,DEPRECATED_getUrlFromRoute:r}=e;t&&(this.config.generateUrlFilter=t),n&&(this.deprecatedConfig.DEPRECATED_getRouteFromUrl=n),r&&(this.deprecatedConfig.DEPRECATED_getUrlFromRoute=r),this.compiledRoutes=S(this.config)}generateUrl(e,t){const{DEPRECATED_getUrlFromRoute:n}=this.deprecatedConfig;return n?n(e,this.config.generateUrl,t):this.config.generateUrl(e,t)}generateUrlAsync(e,t){const{generateUrlFilter:n}=this.config;return n?n(e,this.config.generateUrl,t):Promise.resolve(this.generateUrl(e,t))}parseUrl(e){const{DEPRECATED_getRouteFromUrl:t}=this.deprecatedConfig;return t?t(e,this.config.parseUrl):this.config.parseUrl(e)}matchRoute(e,t){const n="string"==typeof e?e:this.generateUrl(e,t);if(null===n)return null;const r=d(n,this.compiledRoutes,this.config.basePath,this.config.i18n,t),i=r&&g(r.route.pageReference,r.routeDefinition,this.config.basePath,this.config.i18n,t);return r&&i?{pathMatch:i,route:r.route,routeDefinition:r.routeDefinition.original}:null}async resolveView(e,t){return new Promise(((n,r)=>{const i=this.matchRoute(e,t);return i?i.routeDefinition.handler?.().then((e=>{const t=e.default;if(!t)return r(R($.INVALID_ROUTE_HANDLER,[i.routeDefinition.id]));const o=new t(n);o&&o.update(i.route)})):r(R($.NO_ROUTE_MATCH,[JSON.stringify(e)]))}))}navigate(e,t){const n=this.matchRoute(e,t);if(!n)throw new Error(R($.MISSING_ROUTE,[JSON.stringify(e)]));this.pendingRoute={...n},this._mapView(this.pendingRoute)}subscribe(e,t){return this.routeObservable.subscribe({next:e,error:()=>{},complete:()=>{}},Boolean(t))}async _mapView(e){const t=Math.random();this.routeHandlerId=t;const n=await(e.routeDefinition.handler?.()),r=n?.default;if(!r)throw new Error(R($.INVALID_ROUTE_HANDLER,[e.routeDefinition.id]));return this.routeHandler=new r((e=>{this._updateView(t,e)})),this.routeHandler&&this.routeHandler.update(e.route),!0}_updateView(e,t){if(!t||e!==this.routeHandlerId)return;if(!this.pendingRoute)throw new Error("Trying to commit route state without a route");const n=m(t.viewset);this.routeObservable.next({...this.pendingRoute,...t,viewset:n})}}function k(e={}){return new M(e)}export{k as createRouter};
//# sourceMappingURL=router.js.map
