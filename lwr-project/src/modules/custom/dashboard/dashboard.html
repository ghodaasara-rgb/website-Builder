<template>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1 class="dashboard-title">SiteCentral</h1>
                <p class="dashboard-subtitle">Manage all your websites in one place</p>
            </div>
            <button class="btn btn-primary" onclick={handleCreateSite}>
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M8 3.33334V12.6667M3.33334 8H12.6667" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" />
                </svg>
                Create New Site
            </button>
        </header>

        <!-- Search and Filter Bar -->
        <div class="toolbar">
            <custom-searchbar onsearch={handleSearch}></custom-searchbar>

            <custom-filter-buttons active-filter={filterStatus} onfilter={handleFilter}>
            </custom-filter-buttons>

            <div class="view-toggle">
                <button class={isGridView} data-mode="grid" onclick={handleViewChange} title="Grid View">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z" />
                    </svg>
                </button>
                <button class={isTableView} data-mode="table" onclick={handleViewChange} title="Table View">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M3 12h18M3 18h18" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <template if:true={isLoading}>
            <div class="loading-container">
                <div class="spinner"></div>
                <p>Loading your sites...</p>
            </div>
        </template>

        <!-- Empty State -->
        <template if:true={showEmptyState}>
            <custom-emptystate oncreate={handleCreateSite}></custom-emptystate>
        </template>

        <!-- Sites List (Table View) -->
        <template if:true={shouldRenderTable}>
            <div class="sites-table-container">
                <table class="sites-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Info</th>
                            <th>Status</th>
                            <th>Last Modified</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={filteredSites} for:item="site">
                            <tr key={site.id}>
                                <td>
                                    <div class="site-name-cell" onclick={handleOpenBuilder} data-id={site.id}>
                                        <div class="site-icon">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M12 2L2 19h20L12 2z" />
                                            </svg>
                                        </div>
                                        <span class="site-name">{site.name}</span>
                                    </div>
                                </td>
                                <td>
                                    <div class="site-info">
                                        <span class="info-label">Pages:</span> {site.pageCount}
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge status-draft">{site.status}</span>
                                </td>
                                <td>
                                    <span class="date-text">{site.updated_at}</span>
                                </td>
                                <td>
                                    <div class="isActions">
                                        <button class="btn-icon" onclick={handleOpenBuilder} data-id={site.id}
                                            title="Edit">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                                            </svg>
                                        </button>
                                        <button class="btn-icon" onclick={handlePreview} data-id={site.id}
                                            title="Preview">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                                <circle cx="12" cy="12" r="3" />
                                            </svg>
                                        </button>
                                        <button class="btn-icon btn-icon-delete" onclick={handleDelete}
                                            data-id={site.id} title="Delete">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <polyline points="3 6 5 6 21 6" />
                                                <path
                                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </template>

        <!-- Sites Grid (Grid View) -->
        <template if:true={isGridView}>
            <div class="sites-grid">
                <template for:each={filteredSites} for:item="site">
                    <custom-sitecard key={site.id} site={site} onopen={handleOpenBuilder} onpreview={handlePreview}
                        ondelete={handleDelete}></custom-sitecard>
                </template>
            </div>
        </template>

        <!-- Delete Confirmation Modal -->
        <template if:true={showDeleteModal}>
            <div class="modal-overlay" onclick={handleCancelDelete}>
                <div class="modal-content" onclick={stopPropagation}>
                    <div class="modal-header">
                        <h2>Delete Site</h2>
                        <button class="modal-close" onclick={handleCancelDelete}>&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete "<strong>{siteToDelete.name}</strong>"?</p>
                        <p class="warning-text">This action cannot be undone. All pages and components will be
                            permanently deleted.</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick={handleCancelDelete}>Cancel</button>
                        <button class="btn btn-danger" onclick={handleConfirmDelete}>Delete Site</button>
                    </div>
                </div>
            </div>
        </template>
    </div>
</template>