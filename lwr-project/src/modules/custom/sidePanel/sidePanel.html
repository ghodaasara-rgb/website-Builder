<template>
    <div class="side-panel">

        <!-- COMPONENTS PANEL -->
        <template lwc:if={isBuildTab}>
            <div class="panel-header">
                <h3 class="panel-title">Components</h3>
                <button class="btn-icon" onclick={handleImportClick} title="Import Component">
                    <svg style="width:16px;height:16px;" viewBox="0 0 24 24">
                        <path
                            d="M14,2H6C4.89,2 4,2.89 4,4V20C4,21.11 4.89,22 6,22H18C19.11,22 20,21.11 20,20V8L14,2M14,18H10V14H6L12,8L18,14H14V18Z"
                            fill="currentColor" />
                    </svg>
                </button>
                <input type="file" class="file-input-hidden" accept=".zip" onchange={handleFileChange}
                    style="visibility:hidden; position:absolute; width:0; height:0;" />
            </div>
            <template for:each={availableComponents} for:item="comp">
                <div key={comp.type} class="component-item" draggable="true" data-type={comp.type}
                    ondragstart={handleDragStart}>
                    <div class="component-icon">
                        <svg style="width:16px;height:16px;" viewBox="0 0 24 24">
                            <path d={comp.icon} />
                        </svg>
                    </div>
                    <div>
                        <strong style="display:block; font-size: 0.875rem;">{comp.label}</strong>
                        <small style="color: var(--s-text-secondary);">{comp.subtitle}</small>
                    </div>
                </div>
            </template>

        </template>

        <!-- BRANDING PANEL -->
        <template lwc:if={isThemeTab}>
            <div class="panel-header">
                <h3 class="panel-title">Branding</h3>
            </div>
            <div class="panel-content">

                <!-- Active Brand Set -->
                <div class="form-group">
                    <label class="form-label">Active Brand Set</label>
                    <select class="form-select" onchange={handleBrandSetChange}>
                        <template for:each={brandSetOptions} for:item="option">
                            <option key={option.value} value={option.value} selected={option.selected}>{option.label}
                            </option>
                        </template>
                    </select>
                </div>

                <button class="btn-outline-full" onclick={handleSaveSmartSet}>Save as New Smart Set</button>

                <hr class="panel-divider" />

                <!-- Colors -->
                <h4 class="section-title">COLORS</h4>

                <div class="color-item">
                    <label>Primary Color</label>
                    <input type="color" data-id="primary" value={colors.primary} oninput={handleColorChange} />
                </div>

                <div class="color-item">
                    <label>Background</label>
                    <input type="color" data-id="background" value={colors.background} oninput={handleColorChange} />
                </div>

                <div class="color-item">
                    <label>Text Color</label>
                    <input type="color" data-id="text" value={colors.text} oninput={handleColorChange} />
                </div>

                <br />

                <!-- Typography -->
                <h4 class="section-title">TYPOGRAPHY</h4>

                <div class="form-group">
                    <label class="form-label">Primary Font</label>
                    <select class="form-select" data-id="primary" onchange={handleFontChange}>
                        <template for:each={fontOptions} for:item="option">
                            <option key={option.value} value={option.value}>{option.label}</option>
                        </template>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Heading Font</label>
                    <select class="form-select" data-id="heading" onchange={handleFontChange}>
                        <template for:each={fontOptions} for:item="option">
                            <option key={option.value} value={option.value}>{option.label}</option>
                        </template>
                    </select>
                </div>

            </div>
        </template>

        <!-- STRUCTURE PANEL -->
        <template lwc:if={isStructureTab}>
            <div class="panel-header">
                <h3 class="panel-title">Page Structure</h3>
            </div>
            <div class="panel-content">
                <template lwc:if={isEditing}>
                    <div class="property-editor">
                        <button class="btn-back" onclick={handleBackToStructure}>
                            <svg style="width:16px;height:16px;vertical-align:middle;margin-right:4px;"
                                viewBox="0 0 24 24">
                                <path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" />
                            </svg>
                            Back to Structure
                        </button>
                        <h4 class="editor-title">Edit {selectedComponentLabel}</h4>

                        <template for:each={propertyFields} for:item="field">
                            <div key={field.name} class="form-group">
                                <label class="form-label">{field.label}</label>
                                <template lwc:if={field.isTextarea}>
                                    <textarea class="form-input" rows="4" data-name={field.name}
                                        oninput={handlePropertyChange}>{field.value}</textarea>
                                </template>
                                <template lwc:elseif={field.isColor}>
                                    <div class="color-picker-wrapper"
                                        style="display: flex; gap: 8px; align-items: center;">
                                        <input type="color" class="form-input-color" value={field.value}
                                            data-name={field.name} oninput={handlePropertyChange}
                                            style="width: 40px; height: 40px; padding: 0; border: none; cursor: pointer;" />
                                        <input type="text" class="form-input" value={field.value} data-name={field.name}
                                            oninput={handlePropertyChange} style="flex: 1;" placeholder="#000000" />
                                    </div>
                                </template>
                                <template lwc:elseif={field.isCheckbox}>
                                    <div class="form-group" style="flex-direction:row; align-items:center;">
                                        <input type="checkbox" checked={field.value} data-name={field.name}
                                            onchange={handlePropertyChange} style="margin-right:8px;" />
                                        <label class="form-label" style="margin-bottom:0;">{field.label}</label>
                                    </div>
                                </template>
                                <template lwc:elseif={field.isNumber}>
                                    <input type="number" class="form-input" value={field.value} data-name={field.name}
                                        oninput={handlePropertyChange} />
                                </template>
                                <template lwc:else>
                                    <input type="text" class="form-input" value={field.value} data-name={field.name}
                                        oninput={handlePropertyChange} />
                                </template>
                            </div>
                        </template>

                        <hr class="panel-divider" style="margin: 1.5rem 0;" />
                        <h4 class="section-title">DIMENSIONS</h4>

                        <div class="form-group">
                            <label class="form-label">Min Height</label>
                            <input type="text" class="form-input" value={selectedComponent.props.minHeight}
                                data-name="minHeight" oninput={handlePropertyChange} placeholder="e.g. 300px" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Padding Top</label>
                            <input type="text" class="form-input" value={selectedComponent.props.paddingTop}
                                data-name="paddingTop" oninput={handlePropertyChange} placeholder="e.g. 2rem" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Padding Bottom</label>
                            <input type="text" class="form-input" value={selectedComponent.props.paddingBottom}
                                data-name="paddingBottom" oninput={handlePropertyChange} placeholder="e.g. 2rem" />
                        </div>
                    </div>
                </template>

                <template lwc:else>
                    <!-- Existing Tree View -->
                    <template if:true={hasComponents}>
                        <div class="structure-tree">
                            <template for:each={componentStructure} for:item="component">
                                <div key={component.id} class="tree-item">
                                    <div class="tree-item-content" data-id={component.id}
                                        onclick={handleComponentSelect}>
                                        <div class="tree-icon">
                                            <svg style="width:14px;height:14px;" viewBox="0 0 24 24">
                                                <path
                                                    d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19Z" />
                                            </svg>
                                        </div>
                                        <div class="tree-label">
                                            <strong>{component.label}</strong>
                                            <small>{component.type}</small>
                                            <small class="tree-preview">{component.preview}</small>
                                        </div>
                                        <div class="tree-actions" style="display: flex; gap: 2px;">
                                            <button class="tree-btn" title="Move Up" data-index={component.index}
                                                onclick={handleMoveUp}
                                                style="background:none;border:none;cursor:pointer;color:#64748b;padding:2px;">
                                                <svg style="width:14px;height:14px;" viewBox="0 0 24 24">
                                                    <path d="M7,14L12,9L17,14H7Z" fill="currentColor" />
                                                </svg>
                                            </button>
                                            <button class="tree-btn" title="Move Down" data-index={component.index}
                                                onclick={handleMoveDown}
                                                style="background:none;border:none;cursor:pointer;color:#64748b;padding:2px;">
                                                <svg style="width:14px;height:14px;" viewBox="0 0 24 24">
                                                    <path d="M7,10L12,15L17,10H7Z" fill="currentColor" />
                                                </svg>
                                            </button>
                                            <button class="tree-delete" data-id={component.id}
                                                onclick={handleComponentDeleteFromTree}>
                                                <svg style="width:12px;height:12px;" viewBox="0 0 24 24">
                                                    <path
                                                        d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                    <template if:false={hasComponents}>
                        <div class="empty-panel">
                            <svg style="width:48px;height:48px;opacity:0.3;" viewBox="0 0 24 24">
                                <path
                                    d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19Z" />
                            </svg>
                            <p>No components added yet</p>
                            <small>Drag components from the Components tab to get started</small>
                        </div>
                    </template>
                </template>
            </div>
        </template>

        <!-- PAGES PANEL -->
        <template lwc:if={isPagesTab}>
            <div class="panel-header">
                <h3 class="panel-title">Site Pages</h3>
                <button class="btn-icon" onclick={handleAddPage} title="Add New Page">
                    <svg style="width:16px;height:16px;" viewBox="0 0 24 24">
                        <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
                    </svg>
                </button>
            </div>
            <div class="panel-content">
                <template for:each={pages} for:item="page">
                    <div key={page.id} class="page-item" data-id={page.id}>
                        <div class="page-item-content" onclick={handlePageSelect}>
                            <div class="page-icon">
                                <svg style="width:16px;height:16px;" viewBox="0 0 24 24">
                                    <path
                                        d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z" />
                                </svg>
                            </div>
                            <div class="page-details">
                                <strong>{page.name}</strong>
                                <small>{page.slug}</small>
                            </div>
                            <!-- Edit Button -->
                            <button class="page-action-btn" data-id={page.id} onclick={handlePageRename} title="Rename"
                                style="margin-right: 4px; background:none; border:none; cursor:pointer; color:var(--s-text-secondary);">
                                <svg style="width:14px;height:14px;" viewBox="0 0 24 24">
                                    <path
                                        d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"
                                        fill="currentColor" />
                                </svg>
                            </button>
                            <template if:true={page.isActive}>
                                <span class="badge-active">Active</span>
                            </template>
                        </div>
                        <template if:false={page.isActive}>
                            <button class="page-delete" data-id={page.id} onclick={handlePageDelete}>
                                <svg style="width:12px;height:12px;" viewBox="0 0 24 24">
                                    <path
                                        d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                                </svg>
                            </button>
                        </template>
                    </div>
                </template>
            </div>
        </template>

        <!-- SETTINGS PANEL -->
        <template lwc:if={isSettingsTab}>
            <div class="panel-header">
                <h3 class="panel-title">Settings</h3>
            </div>
            <div class="panel-content">

                <!-- Site Information -->
                <h4 class="section-title">SITE INFORMATION</h4>

                <div class="form-group">
                    <label class="form-label">Site Title</label>
                    <input type="text" class="form-input" value={siteSettings.title} data-field="title"
                        onchange={handleSettingChange} placeholder="My Awesome Site" />
                </div>

                <div class="form-group">
                    <label class="form-label">Site Description</label>
                    <textarea class="form-input" rows="3" value={siteSettings.description} data-field="description"
                        onchange={handleSettingChange} placeholder="A brief description of your site"></textarea>
                </div>

                <hr class="panel-divider" />

                <!-- Export &amp; Deploy -->
                <h4 class="section-title">EXPORT &amp; DEPLOY</h4>

                <div class="form-group">
                    <label class="form-label">Export Format</label>
                    <select class="form-select" data-field="exportFormat" onchange={handleSettingChange}>
                        <option value="html">Static HTML</option>
                        <option value="zip">ZIP Archive</option>
                        <option value="json">JSON Data</option>
                    </select>
                </div>

                <button class="btn-primary-full" onclick={handleExportSite}>
                    <svg style="width:14px;height:14px;margin-right:6px;" viewBox="0 0 24 24">
                        <path
                            d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
                            fill="currentColor" />
                    </svg>
                    Export Website
                </button>

                <hr class="panel-divider" />

                <!-- Advanced Settings -->
                <h4 class="section-title">ADVANCED</h4>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" checked={siteSettings.responsiveMode} data-field="responsiveMode"
                            onchange={handleCheckboxChange} />
                        Enable Responsive Mode
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" checked={siteSettings.autoSave} data-field="autoSave"
                            onchange={handleCheckboxChange} />
                        Auto-save Changes
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-label">Viewport Width (Preview)</label>
                    <select class="form-select" data-field="viewportWidth" onchange={handleSettingChange}>
                        <option value="100%">Full Width</option>
                        <option value="1440px">Desktop (1440px)</option>
                        <option value="768px">Tablet (768px)</option>
                        <option value="375px">Mobile (375px)</option>
                    </select>
                </div>

            </div>
        </template>

        <!-- HEADER PANEL -->
        <template lwc:if={isHeaderTab}>
            <div class="panel-header">
                <h3 class="panel-title">Global Header</h3>
            </div>
            <div class="panel-content">
                <h4 class="section-title">LOGO</h4>
                <div class="form-group">
                    <label class="form-label">Logo Type</label>
                    <select class="form-select" data-field="logoType" onchange={handleHeaderChange}>
                        <option value="text" selected={isLogoTextOnly}>Text</option>
                        <option value="image" selected={isLogoImageOnly}>Image</option>
                        <option value="both" selected={isLogoBoth}>Image & Text</option>
                    </select>
                </div>

                <template lwc:if={showLogoText}>
                    <div class="form-group">
                        <label class="form-label">Logo Text</label>
                        <input type="text" class="form-input" value={headerConfig.logoText} data-field="logoText"
                            oninput={handleHeaderChange} />
                    </div>
                </template>

                <template lwc:if={showLogoImage}>
                    <div class="form-group">
                        <label class="form-label">Logo Image URL</label>
                        <input type="text" class="form-input" value={headerConfig.logoSrc} data-field="logoSrc"
                            oninput={handleHeaderChange} placeholder="https://..." />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Alt Text</label>
                        <input type="text" class="form-input" value={headerConfig.logoAlt} data-field="logoAlt"
                            oninput={handleHeaderChange} />
                    </div>
                </template>

                <hr class="panel-divider" />

                <h4 class="section-title">NAVIGATION</h4>
                <template for:each={headerConfig.navLinks} for:item="link" for:index="index">
                    <div key={link.id} class="nav-link-item"
                        style="border: 1px solid var(--s-border-default); padding: 8px; margin-bottom: 8px; border-radius: 4px; background: var(--s-bg-surface);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span style="font-weight: 600; font-size: 0.75rem;">Link {index}</span>
                            <button onclick={handleDeleteNavLink} data-index={index}
                                style="background: none; border: none; cursor: pointer; color: var(--s-text-secondary);">
                                <svg style="width:14px;height:14px;" viewBox="0 0 24 24">
                                    <path
                                        d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"
                                        fill="currentColor" />
                                </svg>
                            </button>
                        </div>
                        <input type="text" class="form-input" style="margin-bottom: 4px;" value={link.label}
                            data-index={index} data-field="label" oninput={handleNavLinkChange} placeholder="Label" />
                        <input type="text" class="form-input" value={link.url} data-index={index} data-field="url"
                            oninput={handleNavLinkChange} placeholder="URL (/home)" />
                    </div>
                </template>

                <button class="btn-outline-full" onclick={handleAddNavLink} style="margin-top: 8px;">
                    + Add Link
                </button>

                <hr class="panel-divider" />

                <h4 class="section-title">STYLE</h4>
                <div class="color-item">
                    <label>Background Color</label>
                    <div class="color-picker-wrapper" style="display: flex; gap: 8px; align-items: center;">
                        <input type="color" class="form-input-color" value={headerConfig.backgroundColor}
                            data-field="backgroundColor" oninput={handleHeaderChange}
                            style="width: 40px; height: 40px; padding: 0; border: none; cursor: pointer;" />
                        <input type="text" class="form-input" value={headerConfig.backgroundColor}
                            data-field="backgroundColor" oninput={handleHeaderChange} style="flex: 1;" />
                    </div>
                </div>

                <div class="color-item">
                    <label>Text Color</label>
                    <div class="color-picker-wrapper" style="display: flex; gap: 8px; align-items: center;">
                        <input type="color" class="form-input-color" value={headerConfig.textColor}
                            data-field="textColor" oninput={handleHeaderChange}
                            style="width: 40px; height: 40px; padding: 0; border: none; cursor: pointer;" />
                        <input type="text" class="form-input" value={headerConfig.textColor} data-field="textColor"
                            oninput={handleHeaderChange} style="flex: 1;" />
                    </div>
                </div>

                <div class="form-group" style="margin-top: 1rem;">
                    <label class="form-label">Header Height</label>
                    <input type="text" class="form-input" value={headerConfig.height} data-field="height"
                        oninput={handleHeaderChange} placeholder="e.g. 80px" />
                    <small style="color: var(--s-text-secondary); display: block; margin-top: 4px;">Default is
                        auto/fit
                        to
                        content</small>
                </div>
            </div>
        </template>


    </div>
</template>